<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:h="http://www.w3.org/1999/html" layout:decorator="layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <title>Appointments</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta th:name="csrf-token" th:content="${_csrf.token}" />
    <script th:src="@{/js/workscheduler.js}"></script>
    <script th:src="@{/codebase/locale/locale_ua.js}" th:remove="(__${#locale}__ == 'en')?'all':'none'" type="text/javascript" charset="utf-8"></script>



    <style type="text/css" media="screen">
        html, body {
            height: 100%;
            padding: 0px;
            margin: 0px;
        }

        .well {
            text-align: right;
        }

        .container-fluid #scheduler_here {
            height: 715px;
            width: 100%;
            border: 1px solid #cecece;
        }

        #scheduler_here {
            border-radius: 4px;
        }

        #my_form {
            position: absolute;
            top: 100px;
            left: 300px;
            z-index: 10001;
            display: none;
            background-color: white;
            border: 2px outset gray;
            padding: 20px;
            font-size: 10pt;
        }

        #my_form label {
            width: 200px;
        }


    </style>
</head>
<body>
<section layout:fragment="content">

    <input id="path" th:value="${#httpServletRequest.getContextPath()}"/>
    <input sec:authorize="hasRole('PATIENT')" value="true"
           id="patient" type="text" hidden="hidden" />
    <p th:id="currentUser" hidden="hidden" sec:authentication="name" />
    <div class="content">
        <div class="container-fluid">
            <div class="row">

                <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 ">
                    <div id="my_form">
                        <label for="description">Appointment</label><input type="text" name="description" hidden="hidden" id="description"/><br/>
                        <button class="btn btn-default" value="Close" id="close"  onclick="close_form()">Cancel</button>
                        <button class="btn btn-default" value="Delete" id="delete" onclick="delete_event()">Delete</button>
                    </div>
                    <div class="dhx_cal_container panel" id="scheduler_here">
                        <div class="dhx_cal_navline">
                            <div class="dhx_cal_prev_button">&nbsp;</div>
                            <div class="dhx_cal_next_button">&nbsp;</div>
                            <div class="dhx_cal_today_button"></div>
                            <div class="dhx_cal_date"></div>
                            <div class="dhx_minical_icon" id="dhx_minical_icon"
                                 onclick="show_minical()">&nbsp;</div>
                            <script type="text/javascript">
                                function show_minical() {
                                    if (scheduler.isCalendarVisible())
                                        scheduler.destroyCalendar();
                                    else
                                        scheduler
                                                .renderCalendar({
                                                    position : "dhx_minical_icon",
                                                    date : scheduler._date,
                                                    navigation : true,
                                                    handler : function(
                                                            date, calendar) {
                                                        scheduler
                                                                .setCurrentView(date);
                                                        scheduler
                                                                .destroyCalendar()
                                                    }
                                                });
                                }
                            </script>
                            <div class="dhx_cal_tab" name="day_tab"></div>
                            <div class="dhx_cal_tab" name="week_tab"></div>
                            <div class="dhx_cal_tab" name="month_tab"></div>
                        </div>
                        <div class="dhx_cal_header"></div>
                        <div class="dhx_cal_data"></div>
                    </div>
                </div>
            </div>
        </div>


        <script type="text/javascript">

            var html = function(id) { return document.getElementById(id); };

            scheduler.showLightbox = function(id) {
                var ev = scheduler.getEvent(id);
                scheduler.startLightbox(id, html("my_form"));

                html("description").focus();
                html("description").value = ev.text;

            };

            function save_form() {
                blockAppointmensAdd();
                var ev = scheduler.getEvent(scheduler.getState().lightbox_id);
                ev.text = html("description").value;


                scheduler.endLightbox(true, html("my_form"));
            }
            function close_form() {
                scheduler.endLightbox(false, html("my_form"));
            }

            function delete_event() {
                var event_id = scheduler.getState().lightbox_id;
                scheduler.endLightbox(false, html("my_form"));
                scheduler.deleteEvent(event_id);
            }
            function blockAppointmensAdd(){
                scheduler.config.readonly = true;
            }


        </script>

        <p id="principal" sec:authorize="isAuthenticated()" sec:authentication="principal.username" hidden="hidden"></p>
    </div>


</section>
</body>
</html>